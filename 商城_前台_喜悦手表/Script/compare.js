var compareBox="compare-box",compareListClass="compare-list",domain=wb_domain;
function addToCompareTable(a,b,e,c,d,h){b=decodeURIComponent(b);if("checkbox"==$(h).attr("type")&&!1==$(h).prop("checked"))removeCompareId(a);else{var f=BasketGetCookie("CompareProducts");if(""!=f&&null!=f){var f=f.split("；"),k=f.length,m=0,l="";for(i=0;i<k;i++){var g=f[i].split("|");""!=f[i]&&null!=f[i]&&(g=g[0],null==g&&(g=""),!isNaN(Number(g))&&(""!=g&&null!=g&&0<Number(g))&&(++m,l=l+","+g))}if(4>m){if(-1!=l.indexOf(a)){alert("该款已经存在于对比栏！");return}BasketCheckSetCookieValue("CompareProducts",a+
"|"+b+"|"+e+"|"+c+"|"+d,24)}else{alert("您最多可以选择四款表");$(h).attr("checked",!1);return}}else BasketCheckSetCookieValue("CompareProducts",a+"|"+b+"|"+e+"|"+c+"|"+d,24);genRaw();showCompareTable()}}
function genRaw(){var a=BasketGetCookie("CompareProducts");null==a&&(a="");a=a.split("；");a.reverse();var b="",e=0;for(i=0;i<a.length;i++){var c=a[i].split("|");if(""!=a[i]&&null!=a[i]){var d=c[0],h=c[1],f=c[2],k=c[3],c=c[4];null==d&&(d="");null==h&&(h="");null==f&&(f="");null==k&&(k="");null==c&&(c="");""!=d&&(""!=h&&""!=f&&""!=k&&""!=c)&&(++e,b+=productBlock(d,h,f,k,c),$("ul.goods-list>li>label>#product_"+d).attr("checked",!0))}}0==e?b+=productBlockSelect(1)+productBlockSelect(2):4>e&&(b+=productBlockSelect(2));
$("."+compareListClass).html(b);$(".compare_select_brand").each(function(){addOption($(this).attr("id"))});0<e&&(showCompareTable(),$("#compare-box>.compare-box_sub").css("visibility","visible"))}
function productBlock(a,b,e,c,d){return""+('\t<li title="'+b+'" id="compare_product_'+a+'">\t\t\t\t<a href="'+c+'" target="_blank"><img src="'+e+'" alt="" width="100" height="100"></a><p>\t\t\t\t<span><a href="'+c+'" target="_blank" class="pname">'+b+"</a></span>\t\t\t\t<b>"+d+'</b>\t\t\t\t<br><a href="javascript:void(0);" onclick="removeCompareId(\''+a+'\')" class="removeButton" rel="nofollow" title="移除"></a></p>\t\t\t\t<input type="hidden" class="compare_value" value="'+a+'" />\t\t\t</li>')}
function productBlockSelect(a){return""+('\t<li>\t\t\t\t<select class="compare_select_brand" id="compare_select_brand'+a+'" onchange="select_series(this.options[this.options.selectedIndex].value,'+a+')">\t\t\t\t<option value="0">请选择品牌</option>\t\t\t\t</select>\t\t\t\t<select name="compare_select_series" id="compare_select_series'+a+'" onchange="select_series_goods(this.options[this.options.selectedIndex].value)">\t\t\t\t<option value="0">请选择型号</option>\t\t\t\t</select>\t\t\t</li>')}
function select_series(a,b){$.post("/compare/get_brand_series/",{brand:a,sid:b},function(a){0==a.error&&($("#compare_select_series"+a.sid).empty(),$("#compare_select_series"+a.sid).append('<option value="0">请选择型号</option>'),$("#compare_select_series"+a.sid).append(a.msg))},"json")}function select_series_goods(a){$.post("/compare/get_brand_goods/",{goods_id:a},function(a){0==a.error&&addToCompareTable(a.pid,a.pname,a.pimg,a.purl,a.price,"")},"json")}
function BasketEncodeCookie(a){for(var b="",e=a.length-1;0<=e;e--)b+=a.charCodeAt(e),e&&(b+="a");return b}function BasketDecodeCookie(a){var b="";a=a.split("a");for(var e=a.length-1;0<=e;e--)b+=String.fromCharCode(eval(a[e]));return b}
function BasketGetCookie(a){for(var b=a+"=",e=b.length,c=document.cookie.length,d=0;d<c;){a=d+e;if(document.cookie.substring(d,a)==b)return b=document.cookie.indexOf(";",a),-1==b&&(b=document.cookie.length),BasketDecodeCookie(unescape(document.cookie.substring(a,b)));d=document.cookie.indexOf(" ",d)+1;if(0==d)break}return null}
function BasketSetCookie(a,b,e){var c=new Date;c.setTime(c.getTime()+36E5*e);document.cookie=a+"="+escape(BasketEncodeCookie(b))+";expires="+c.toGMTString()+";path=/;domain="+domain}
function BasketCheckSetCookieValue(a,b,e){var c=BasketGetCookie(a);if(""==c||null==c){var d=new Date;d.setTime(d.getTime()+36E5*e);document.cookie=a+"="+escape(BasketEncodeCookie(b))+";expires="+d.toGMTString()+";path=/;domain="+domain}else if(-1==c.indexOf(b)){d=c.split("；");if(4<d.length){c="";for(loop=0;4>loop;loop++)c+=d[loop]+"；";c=c.substring(0,c.lastIndexOf("；"))}d=new Date;d.setTime(d.getTime()+36E5*e);document.cookie=a+"="+escape(BasketEncodeCookie(b+"；"+c))+";expires="+d.toGMTString()+";path=/;domain="+
domain}}function deleteFromCompareTable(a){var b=BasketGetCookie("CompareProducts");if(null!=b&&""!=b){var e=b.split("；"),c=e.length;if(-1<b.indexOf(a)){b="";for(i=0;i<c;i++)-1==e[i].indexOf(a)&&(b+=e[i]+"；");b=b.substring(0,b.lastIndexOf("；"));BasketSetCookie("CompareProducts",b,24)}genRaw();a=a.replace("_product","");$("#"+a).attr("checked",!1)}}function Empty(){BasketSetCookie("CompareProducts","",24)}
function showCompareTable(){1024<window.screen.width&&$("#"+compareBox).css("margin-left","-385px");$("#"+compareBox).css("width","960px").css("height","150px").show()}function removeCompareTable(){Empty();$("ul.goods-list>li>label>input").each(function(){$(this).attr("checked",!1)});productBlockSelect();$("."+compareListClass).html(productBlockSelect(1)+productBlockSelect(2));$(".compare_select_brand").each(function(){addOption($(this).attr("id"))})}
function removeCompareId(a){deleteFromCompareTable(a);$("ul.goods-list>li>label>#product_"+a).attr("checked",!1);$("."+compareListClass+">#compare_product_"+a).remove()}function compare_close(){$("#compare-box").css("display","none");$("#compare-box>.compare-box_sub").css("visibility","hidden")}
function CompareNow(){var a=BasketGetCookie("CompareProducts"),b=0;if(""!=a&&null!=a)var e=a.split("；"),b=e.length;var a=[],c=0;for(i=0;i<b;i++){var d=e[i].split("|");""!=e[i]&&null!=e[i]&&(d=d[0],null==d&&(d=""),!isNaN(Number(d))&&(""!=d&&null!=d&&0<Number(d))&&(a[c++]=d))}2>c?alert("请至少选择两款表"):5<c?alert("您最多可以选择四款表"):(productsString=a.join(","),window.open("/compare/?id="+productsString))}
function compareHtml(){var a='\t<div id="'+compareBox+'"><div class="'+compareBox+'_sub">\t\t\t\t  \t<div class="title"><strong>表款对比</strong> <a href="javascript:void(0);" onclick="compare_close()" rel="nofollow" title="关闭"><img src="/theme/images/compare/compare-close.gif"></a></div>\t\t\t\t  \t<ul class="compare-list">';document.write(a+'\t\t</ul>\t\t\t\t  \t<div class="compare-btn"><a href="javascript:void(0);" onclick="CompareNow()" rel="nofollow" title="开始对比"><img src="/theme/images/compare/compare-btn.gif"></a><a href="javascript:void(0);" onclick="removeCompareTable()" rel="nofollow" title="清空列表"><img src="/theme/images/compare/compare-btn-off.gif"></a></div>\t\t\t\t </div></div>')}
compareHtml();genRaw();
$(function(){$("#goods_list>ul>li>label>input").each(function(){$(this).attr("title","勾选加入表款对比")});$("#goods_list>ul>li").hover(function(){$(this).find("label").removeClass("compare-off").addClass("compare-on")},function(){$(this).find("label").removeClass("compare-on").addClass("compare-off")});$(".compare-box_sub").offset();$(".c__compare").click(function(){var a=$("#compare-box"),b=a.find("div.compare-box_sub");"visible"==b.css("visibility")?(b.css("visibility","hidden"),a.css("width","1px").css("height",
"1px").css("display","none")):(b.css("visibility","visible"),a.css("width","960px").css("height","150px").css("display","block"))})});
